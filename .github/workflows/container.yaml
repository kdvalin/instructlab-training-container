on:
  push:
    branches:
      - main
      - 'v**'
  
jobs:
  build_image:
    name: Build Docker Image
    runs-on: ubuntu-latest
    steps:

    - name: Free Disk Space (Ubuntu)
      uses: jlumbroso/free-disk-space@main
      with:
        # this might remove tools that are actually needed,
        # if set to "true" but frees about 6 GB
        tool-cache: false
        
        # all of these default to true, but feel free to set to
        # "false" if necessary for your workflow
        android: true
        dotnet: true
        haskell: true
        large-packages: true
        docker-images: true
        swap-storage: true
    - name: Checkout
      uses: actions/checkout@v3
    
    - name: Build CUDA container
      run: >
        docker build -t test:$(< ilab-version.txt)
        --build-arg="TRAINING_VERSION=$(< ilab_version.txt)"
        -f Containerfile .
      continue-on-error: true
    
    - name: Show disk space
      run: df -h && false